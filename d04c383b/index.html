<!DOCTYPE html><html lang=zh-CN><head><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><title>Cloudflare for SaaS实现CF自选IP | CDN | Blog | btwoa</title><meta name=description content="Cloudflare for SaaS实现CF自选IP | CDN | btwoa"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://ovo.btwoa.com/favicon/hexo/favicon.png><link rel=stylesheet href=/css/apollo.css><link rel=search type=application/opensearchdescription+xml href=https://blog.btwoa.com/atom.xml title="Blog | btwoa"><script integrity=sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq src=//instant.page/5.1.1 type=module></script><!-- hexo injector head_end start --><link rel=manifest href=/manifest.json><!-- hexo injector head_end end --><meta name=generator content="Hexo 6.2.0"><link rel=alternate href=/atom.xml title="Blog | btwoa" type=application/atom+xml><link rel=alternate href=/rss.xml title="Blog | btwoa" type=application/rss+xml></head><body><div class=container data-bs-spy=scroll data-bs-target=#toc-nav data-bs-offset=0></div><div class=wrap><header><a class=logo-link href=/ ><img src=https://ovo.btwoa.com/blog.webp alt=logo></a><ul class="nav nav-list"><li class=nav-list-item><a class=nav-list-link href=https://btwoa.com target=_blank>主页</a></li><li class=nav-list-item><a class=nav-list-link href=/talk/ target=_self>说说</a></li><li class=nav-list-item><a class=nav-list-link href=/circle/ target=_self>小圈</a></li><li class=nav-list-item><a class=nav-list-link href=/link/ target=_self>友链</a></li><li class=nav-list-item><a class=nav-list-link href=/archives/ target=_self>归档</a></li><li class=nav-list-item><a class=nav-list-link href=https://monitor.btwoa.com target=_blank>监测</a></li></ul></header><main class=container><article class=post-block><h1 class=post-title>Cloudflare for SaaS实现CF自选IP | CDN</h1><div class=post-info>2022年9月11日<div class=post-tags><a class=post-tag-link href=/tags/Cloudflare-CDN/ rel=tag># Cloudflare CDN</a></div></div><div class=post-toc><h3 class=post-toc-title>Cloudflare for SaaS实现CF自选IP | CDN</h3><nav class=navbar id=toc-nav><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%90%AF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8A%82%E7%82%B9%E7%9A%84%E8%B5%B7%E5%9B%A0><span class=nav-text>启用自定义节点的起因</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%88%A9%E7%94%A8Cloudflare-Partner%E8%87%AA%E9%80%89%E8%8A%82%E7%82%B9><span class=nav-text>利用Cloudflare Partner自选节点</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%88%A9%E7%94%A8Cloudflare-for-SaaS%E8%87%AA%E9%80%89%E8%8A%82%E7%82%B9><span class=nav-text>利用Cloudflare for SaaS自选节点</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%BC%80%E9%80%9ACloudflare-for-SaaS><span class=nav-text>开通Cloudflare for SaaS</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%BB%91%E5%AE%9A%E9%93%B6%E8%A1%8C%E5%8D%A1%E6%88%96PayPal><span class=nav-text>绑定银行卡或PayPal</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#NS%E6%8E%A5%E5%85%A5%E5%9B%9E%E9%80%80%E6%BA%90%E5%9F%9F%E5%90%8D><span class=nav-text>NS接入回退源域名</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%B7%BB%E5%8A%A0%E5%9B%9E%E9%80%80%E6%BA%90><span class=nav-text>添加回退源</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%BB%E6%9C%BA%E5%90%8D><span class=nav-text>添加自定义主机名</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#TXT%E9%AA%8C%E8%AF%81><span class=nav-text>TXT验证</span></a></li></ol></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%B8%BB%E5%9F%9F%E5%90%8D%E6%8C%87%E5%90%91%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8A%82%E7%82%B9><span class=nav-text>主域名指向自定义节点</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#CNAME%E6%8C%87%E5%90%91%E7%AC%AC%E4%B8%89%E6%96%B9%E8%8A%82%E7%82%B9%E5%90%88%E9%9B%86><span class=nav-text>CNAME指向第三方节点合集</span></a></li><li class="nav-item nav-level-5"><a class=nav-link href=#A%E8%AE%B0%E5%BD%95%E6%8C%87%E5%90%91%E8%87%AA%E9%80%89%E8%8A%82%E7%82%B9><span class=nav-text>A记录指向自选节点</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BD%91%E7%AB%99%E8%AE%BF%E9%97%AE%E9%80%9F%E5%BA%A6%E5%AF%B9%E7%85%A7><span class=nav-text>网站访问速度对照</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%9C%AA%E9%85%8D%E7%BD%AECDN><span class=nav-text>未配置CDN</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#Cloudflare-CDN-%E5%85%8D%E8%B4%B9%E6%96%B9%E6%A1%88><span class=nav-text>Cloudflare CDN 免费方案</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#Cloudflare-for-SaaS%E8%87%AA%E9%80%89%E8%8A%82%E7%82%B9><span class=nav-text>Cloudflare for SaaS自选节点</span></a></li></ol></li></nav></div><div class=post-content><p>记录Cloudflare CDN自选IP的全过程，这只是向免费妥协的优化手段，当然，最好的方案还是上云，使用付费套餐</p><span id=more></span><h2 id=启用自定义节点的起因><a href=#启用自定义节点的起因 class=headerlink title=启用自定义节点的起因></a>启用自定义节点的起因</h2><p>@<a target=_blank rel=noopener href=https://www.yyyzyyyz.cn/ >Black Flies</a>访问时加载速度缓慢，这明显不太正常</p><p><img src=https://ovo.btwoa.com/img/webp/202209111155006.webp></p><p>猜测是使用Cloudflare CDN免费方案导致的。官方默认分配的节点位于旧金山（172.67.216.174），导致国内首次访问时加载缓慢。</p><p><img src=https://ovo.btwoa.com/img/webp/202209111253256.webp></p><p>优质的服务是需要付费的，但这与免费搭建本站的初衷相悖，故采用以下取巧的方案</p><h2 id=利用Cloudflare-Partner自选节点><a href=#利用Cloudflare-Partner自选节点 class=headerlink title="利用Cloudflare Partner自选节点"></a>利用Cloudflare Partner自选节点</h2><p><a target=_blank rel=noopener href=https://www.cloudflare.com/partners/become-a-partner>申请官方账户</a><a target=_blank rel=noopener href=https://github.com/Netrvin/CFPMP>自建平台</a>或利用第三方平台，如<a target=_blank rel=noopener href=https://cdn.wzfou.com/ >挖站否</a>，<a target=_blank rel=noopener href=https://www.mnn.tw/panel>梦牛</a>等，CNAME接入Cloudflare后，自选优质节点后按运营商解析。但2021年11月官方下场禁用了Host API key，使得后续域名无法通过此方法接入，Cloudflare Partner就此没落</p><p><img src=https://ovo.btwoa.com/img/webp/202209111221973.webp></p><h2 id=利用Cloudflare-for-SaaS自选节点><a href=#利用Cloudflare-for-SaaS自选节点 class=headerlink title="利用Cloudflare for SaaS自选节点"></a>利用Cloudflare for SaaS自选节点</h2><p><a target=_blank rel=noopener href=https://github.com/dalaolala/blog/issues/46>Github相应教程</a></p><p>原理是使用SSL&#x2F;TLS Custom Hostnames设置回退源</p><p>这里用主域名示范设置过程，实际需为回退源域名配置以下步骤</p><p>建议注册便宜域名或[在Freenom注册免费域名当回退源](<a href=https://blog.btwoa.com/29ccf94f>申请Freenom免费域名 | Blog | btwoa</a>)</p><p><img src=https://ovo.btwoa.com/img/webp/202209111234126.webp></p><h4 id=开通Cloudflare-for-SaaS><a href=#开通Cloudflare-for-SaaS class=headerlink title="开通Cloudflare for SaaS"></a>开通Cloudflare for SaaS</h4><p><img src=https://ovo.btwoa.com/img/webp/202209111237076.webp></p><h4 id=绑定银行卡或PayPal><a href=#绑定银行卡或PayPal class=headerlink title=绑定银行卡或PayPal></a>绑定银行卡或PayPal</h4><p>我绑定的是PayPal</p><p><img src=https://ovo.btwoa.com/img/webp/202209111240545.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111242116.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111245684.webp></p><h4 id=NS接入回退源域名><a href=#NS接入回退源域名 class=headerlink title=NS接入回退源域名></a>NS接入回退源域名</h4><p><img src=https://ovo.btwoa.com/img/webp/202209111339400.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111257716.webp></p><h4 id=添加回退源><a href=#添加回退源 class=headerlink title=添加回退源></a>添加回退源</h4><p><img src=https://ovo.btwoa.com/img/webp/202209111346822.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111347099.webp></p><h4 id=添加自定义主机名><a href=#添加自定义主机名 class=headerlink title=添加自定义主机名></a>添加自定义主机名</h4><p><img src=https://ovo.btwoa.com/img/webp/202209111353419.webp></p><h5 id=TXT验证><a href=#TXT验证 class=headerlink title=TXT验证></a>TXT验证</h5><p><img src=https://ovo.btwoa.com/img/webp/202209111356430.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111357467.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111404090.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111405447.webp></p><p><img src=https://ovo.btwoa.com/img/webp/202209111422245.webp></p><h4 id=主域名指向自定义节点><a href=#主域名指向自定义节点 class=headerlink title=主域名指向自定义节点></a>主域名指向自定义节点</h4><h5 id=CNAME指向第三方节点合集><a href=#CNAME指向第三方节点合集 class=headerlink title=CNAME指向第三方节点合集></a>CNAME指向第三方节点合集</h5><p>可选用 <a target=_blank rel=noopener href=https://ipcf.tk/ >ipcf.tk</a></p><p><img src=https://ovo.btwoa.com/img/webp/202209111433832.webp></p><h5 id=A记录指向自选节点><a href=#A记录指向自选节点 class=headerlink title=A记录指向自选节点></a>A记录指向自选节点</h5><p><a target=_blank rel=noopener href=https://github.com/XIU2/CloudflareSpeedTest>CloudflareSpeedTest</a>或<a target=_blank rel=noopener href=https://github.com/badafans/better-cloudflare-ip># better cloudflare ip</a></p><p>自测的IP</p><p><img src=https://ovo.btwoa.com/img/webp/202209111446957.webp></p><h2 id=网站访问速度对照><a href=#网站访问速度对照 class=headerlink title=网站访问速度对照></a>网站访问速度对照</h2><h4 id=未配置CDN><a href=#未配置CDN class=headerlink title=未配置CDN></a>未配置CDN</h4><p><img src=https://ovo.btwoa.com/img/webp/202209111501082.webp></p><h4 id=Cloudflare-CDN-免费方案><a href=#Cloudflare-CDN-免费方案 class=headerlink title="Cloudflare CDN 免费方案"></a>Cloudflare CDN 免费方案</h4><p><img src=https://ovo.btwoa.com/img/webp/202209111502715.webp></p><h4 id=Cloudflare-for-SaaS自选节点><a href=#Cloudflare-for-SaaS自选节点 class=headerlink title="Cloudflare for SaaS自选节点"></a>Cloudflare for SaaS自选节点</h4><p><img src=https://ovo.btwoa.com/img/webp/202209111522962.webp></p><link rel=stylesheet href=/css/spoiler.css type=text/css><script src=/js/spoiler.js type=text/javascript async></script></div></article></main><footer><div class=paginator><a class=prev href=/29ccf94f/ >PREV</a><a class=next href=/8140beac/ >NEXT</a></div><div id=tcomment></div><script src=/js/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo.btwoa.com/",el:"#tcomment",path:"window.location.pathname",lang:"zh-CN"})</script><div class=copyright><p>Copyright Ⓒ 2019-2022 <a href=https://beian.miit.gov.cn/ target=_blank>陇ICP备20001210号</a></p></div></footer></div><script>!function(e,a,t,g,n,o){e.GoogleAnalyticsObject=g,e.ga||(e.ga=function(){(e.ga.q=e.ga.q||[]).push(arguments)}),e.ga.l=+new Date,n=a.createElement(t),o=a.getElementsByTagName(t)[0],n.src="/js/google-analytics.js",o.parentNode.insertBefore(n,o)}(window,document,"script","ga"),ga("create","UA-235222810-1","auto"),ga("send","pageview")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?01b308cf7144f10b91966ae6f284d4cb",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><script>!function(t){"use strict";function s(){e.LA.ids.push(i)}var e=window,c=document,i=t,o="".concat("https:"===c.location.protocol?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),n=c.createElement("script"),c=c.getElementsByTagName("script")[0];n.type="text/javascript",n.setAttribute("charset","UTF-8"),n.async=!0,n.src=o,n.id="LA_COLLECT",i.d=n,e.LA?e.LA.ids&&s():(e.LA=t,e.LA.ids=[],s()),c.parentNode.insertBefore(n,c)}({id:"JoXIxCzhNG7DwlUJ",ck:"JoXIxCzhNG7DwlUJ"})</script><script>!function(e,n){var t=n.createElement("script"),n=n.getElementsByTagName("script")[0];t.type="text/javascript",t.crossorigin=!0,t.onload=function(){(new e.LingQue.Monitor).init({id:"JoewdpDnTBrOF23U",sendSuspicious:!0,sendSpaPv:!0})},n.parentNode.insertBefore(t,n),t.src="https://sdk.51.la/perf/js-sdk-perf.min.js"}(window,document)</script><script defer=defer src=/js/bootstrap.min.js type=text/javascript></script><script defer=defer src=/js/console.js type=text/javascript></script><!-- hexo injector body_end start --><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js")})</script><!-- hexo injector body_end end --></body></html>